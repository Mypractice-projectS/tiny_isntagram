{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<div class="max-w-xl mx-auto mt-10 bg-white p-8 rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold text-center mb-6">Create Your Profile</h2>

    <form id="profileForm" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}

        <div>
            <label class="block text-sm font-medium text-gray-700">Profile Picture</label>
            <input type="file" id="avatar" name="avatar" accept="image/*" class="mt-2 p-2 w-full border rounded-lg">
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700">First Name</label>
            <input type="text" id="first_name" name="first_name" placeholder="Enter your first name" class="mt-2 p-2 w-full border rounded-lg" required>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700">Last Name</label>
            <input type="text" id="last_name" name="last_name" placeholder="Enter your last name" class="mt-2 p-2 w-full border rounded-lg" required>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700">Age</label>
            <input type="number" id="age" name="age" min="1" placeholder="Enter your age" class="mt-2 p-2 w-full border rounded-lg">
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700">Bio</label>
            <textarea id="bio" name="bio" rows="4" placeholder="Tell us about yourself..." class="mt-2 p-2 w-full border rounded-lg"></textarea>
        </div>

        <div class="text-center">
            <button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-600 transition">Save Profile</button>
        </div>
    </form>
</div>

<script>
    document.getElementById('profileForm').addEventListener('submit', async function(event) {
        event.preventDefault();
    
        const formData = new FormData(this);
    
        // بررسی انتخاب تصویر پروفایل
        const avatar = document.getElementById('avatar').files[0];
        if (avatar && avatar.size > 5 * 1024 * 1024) {  // حداکثر حجم تصویر 5MB
            alert('The file size exceeds the maximum allowed size of 5MB.');
            return;
        }
    
        console.log('Form Data:', formData);  // لاگ داده‌های فرم برای بررسی
    
        try {
            const response = await fetch('http://127.0.0.1:8000/api/profile/', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                },
                body: formData
            });
    
            console.log('Response Status:', response.status);  // لاگ وضعیت پاسخ
    
            const responseData = await response.json();
            console.log('Response Data:', responseData);  // لاگ داده‌های پاسخ
    
            if (!response.ok) {
                console.error('Error Response:', responseData);  // لاگ خطای پاسخ
                alert(`Error: ${JSON.stringify(responseData)}`);
            } else {
                console.log('Profile Created Successfully');
                console.log('Response Data:', responseData);
                console.log('Response Data:', responseData.id);
                // پس از ایجاد پروفایل، کاربر را به صفحه پروفایل هدایت می‌کنیم
                if (responseData && responseData.id) {
                    window.location.href = `/profile/${responseData.id}/`;  // هدایت به صفحه پروفایل با شناسه id
                } else {
                    alert("Profile creation failed. No ID returned.");
                }
            }
        } catch (error) {
            console.error('Request Failed:', error);
            alert('An unexpected error occurred. Check the console for details.');
        }
    });
</script>

</body>
</html>
